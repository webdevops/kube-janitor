## TTL removal by annotation or label
ttl:
  ## checks all resources by annotation
  annotation: janitor/ttl

  ## checks all resources by label
  # label: janitor/ttl

  resources:
    # definition of resources by group, version, kind (GVR)
    # a wildcard ("*") will try to match as many possible resources
    # from the serverside GVK list, be careful with it!
    - {group: "", version: "v1", kind: "pods"}
    - {group: "", version: v1, kind: secrets}
    - {group: apps, version: "*", kind: "*"}

# static rules (fixed TTLs without using ttl definition in labels/annotations)
rules:
  # cleanup of completed/failed pods which are not yet removed by the Kubernetes control plane
  - id: CleanupCompletedPods
    resources:
      - group: ""
        version: v1
        kind: pods

        ## get timestampo from containerStatuses if pod is terminated
        timestampPath: |-
          max(containerStatuses[*].state.terminated.finishedAt)

        ## filter only pods which are in phase "Failed" or "Succeeded"
        filterPath: |-
          phase == 'Failed' || phase == 'Succeeded'

        selector: {}

    ## run on all namespaces
    namespaceSelector: {}

    ## ttl for rule (based on terminated.finishedAt)
    ttl: 1h

  - id: example
    resources:
      - group: ""
        version: v1
        kind: configmaps
        # JMESpath for additional selector, should return true if resource should be used for TTL checks, optional
        filterPath: |-
          !(metadata.annotations."kubernetes.io/description")

        # kubernetes selector (matchLabels, matchExpressions), optional
        selector:
          matchLabels:
            foo: bar

    # kubernetes selector (matchLabels, matchExpressions), optional
    # if a namespaceSelector is active only namespaced resources will be checked
    # !! be careful !!
    # to force this behaviour for all namespaces try
    #   namespaceSelector:
    #     matchExpressions:
    #       - { key: "kubernetes.io/metadata.name", operator: Exists }

    namespaceSelector:
      matchLabels:
        kubernetes.io/metadata.name: default

    ttl: 1h # resources expires 1 hour after creation
